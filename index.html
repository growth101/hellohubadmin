<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Alex Davis Care Group - Admin Dashboard</title>
    <link rel="icon" type="image/png" sizes="32x32" href="alex-davis-favicon.png">
    <link rel="icon" type="image/png" sizes="16x16" href="alex-davis-favicon.png">
    <link rel="apple-touch-icon" sizes="180x180" href="alex-davis-favicon.png">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh; padding: 10px;
        }
        .dashboard-container {
            max-width: 1200px; margin: 0 auto;
            background: rgba(255, 255, 255, 0.98); border-radius: 24px;
            box-shadow: 0 25px 50px rgba(0,0,0,0.15); overflow: hidden;
            backdrop-filter: blur(20px); border: 1px solid rgba(255,255,255,0.2);
        }
        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white; padding: 30px 20px; text-align: center;
            position: relative; overflow: hidden;
        }
        .header::before {
            content: ''; position: absolute; top: 0; left: 0; right: 0; bottom: 0;
            background: linear-gradient(45deg, rgba(255,255,255,0.1) 0%, transparent 100%);
        }
        .header h1 { font-size: 28px; margin-bottom: 8px; font-weight: 300; position: relative; z-index: 1; }
        .header p { opacity: 0.9; font-size: 14px; font-weight: 300; position: relative; z-index: 1; }
        .controls {
            padding: 15px; background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-bottom: 1px solid rgba(0,0,0,0.08);
            display: flex; gap: 10px; align-items: center; flex-wrap: wrap;
        }
        .btn {
            padding: 10px 16px; border: none; border-radius: 8px; cursor: pointer;
            font-weight: 500; transition: all 0.3s ease; font-size: 13px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1); flex-shrink: 0;
        }
        .btn-primary { 
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%); 
            color: white; 
        }
        .btn-success { 
            background: linear-gradient(135deg, #27ae60 0%, #229954 100%); 
            color: white; 
        }
        .btn-warning { 
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%); 
            color: white; 
        }
        .btn:hover { 
            transform: translateY(-1px); 
            box-shadow: 0 6px 20px rgba(0,0,0,0.15); 
        }
        .btn:active { 
            transform: translateY(0); 
            box-shadow: 0 4px 15px rgba(0,0,0,0.1); 
        }
        .stats {
            padding: 20px 15px; display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px; background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
        }
        .stat-card {
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            padding: 20px 15px; border-radius: 12px; text-align: center;
            box-shadow: 0 6px 25px rgba(0,0,0,0.08);
            border: 1px solid rgba(0,0,0,0.05);
            transition: all 0.3s ease;
        }
        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(0,0,0,0.12);
        }
        .stat-number { 
            font-size: 28px; font-weight: 600; color: #2c3e50; 
            margin-bottom: 6px; 
        }
        .stat-label { 
            color: #7f8c8d; font-size: 12px; font-weight: 500; 
            text-transform: uppercase; letter-spacing: 0.5px; 
        }
        .data-section { padding: 20px 15px; background: #ffffff; }
        .section-title { 
            font-size: 18px; font-weight: 600; margin-bottom: 15px; 
            color: #2c3e50; 
        }
        .visitor-table {
            width: 100%; border-collapse: collapse; 
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%); 
            border-radius: 12px; overflow: hidden; 
            box-shadow: 0 8px 25px rgba(0,0,0,0.08);
        }
        .visitor-table th, .visitor-table td {
            padding: 12px 8px; text-align: left; border-bottom: 1px solid rgba(0,0,0,0.06);
            font-size: 13px;
        }
        .visitor-table th {
            background: linear-gradient(135deg, #34495e 0%, #2c3e50 100%);
            color: white; font-weight: 600; font-size: 12px;
            text-transform: uppercase; letter-spacing: 0.3px;
        }
        .visitor-table tr:hover { 
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 50%, #f8f9fa 100%); 
        }
        .status-badge {
            padding: 4px 8px; border-radius: 16px; font-size: 10px; font-weight: 600;
            text-transform: uppercase; letter-spacing: 0.3px;
        }
        .status-arrived { 
            background: linear-gradient(135deg, #d4f6d4 0%, #c8e6c9 100%); 
            color: #2e7d32; border: 1px solid #a5d6a7; 
        }
        .status-departed { 
            background: linear-gradient(135deg, #ffebee 0%, #ffcdd2 100%); 
            color: #c62828; border: 1px solid #ef9a9a; 
        }
        .loading { 
            text-align: center; padding: 40px 20px; color: #7f8c8d; 
            font-size: 14px; font-weight: 300; 
        }
        .error { 
            background: linear-gradient(135deg, #ffebee 0%, #ffcdd2 100%); 
            color: #c62828; padding: 15px; border-radius: 10px; margin: 15px; 
            border: 1px solid #ef9a9a; font-size: 14px;
        }
        .filters {
            display: flex; gap: 8px; align-items: center; flex-wrap: wrap;
            width: 100%;
        }
        .filter-input {
            padding: 8px 12px; border: 2px solid rgba(0,0,0,0.1); 
            border-radius: 8px; font-size: 13px;
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            transition: all 0.3s ease; min-width: 120px;
        }
        .filter-input:focus { 
            outline: none; border-color: #3498db; 
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.1);
            background: #ffffff;
        }
        .recent-activity {
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%); 
            border-radius: 12px; padding: 20px 15px; margin-top: 20px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.08);
            border: 1px solid rgba(0,0,0,0.05);
        }
        .activity-item {
            padding: 12px 0; border-bottom: 1px solid rgba(0,0,0,0.06); 
            display: flex; justify-content: space-between; align-items: center;
            transition: all 0.3s ease; font-size: 13px;
        }
        .activity-item:hover {
            padding-left: 8px;
            background: linear-gradient(135deg, rgba(52, 152, 219, 0.05) 0%, transparent 100%);
        }
        .activity-item:last-child { border-bottom: none; }
        .activity-time { color: #7f8c8d; font-size: 11px; font-weight: 500; }

        /* Mobile-specific styles */
        @media (max-width: 768px) {
            body { padding: 5px; }
            
            .dashboard-container { border-radius: 16px; }
            
            .header { padding: 20px 15px; }
            .header h1 { font-size: 24px; }
            .header p { font-size: 13px; }
            
            .controls { 
                padding: 12px; 
                flex-direction: column; 
                align-items: stretch; 
                gap: 12px; 
            }
            
            .btn { 
                width: 100%; 
                padding: 12px; 
                font-size: 14px; 
                text-align: center; 
            }
            
            .filters { 
                flex-direction: column; 
                gap: 10px; 
                align-items: stretch; 
            }
            
            .filter-input { 
                width: 100%; 
                min-width: auto; 
                padding: 10px; 
            }
            
            .stats { 
                grid-template-columns: repeat(2, 1fr); 
                gap: 12px; 
                padding: 15px 10px; 
            }
            
            .stat-card { padding: 15px 10px; }
            .stat-number { font-size: 24px; }
            .stat-label { font-size: 11px; }
            
            .data-section { padding: 15px 10px; }
            .section-title { font-size: 16px; }
            
            /* Mobile table - hide less important columns but keep contact info */
            .visitor-table th:nth-child(6),
            .visitor-table td:nth-child(6),
            .visitor-table th:nth-child(7),
            .visitor-table td:nth-child(7) {
                display: none;
            }
            
            .visitor-table th, .visitor-table td {
                padding: 8px 4px;
                font-size: 12px;
            }
            
            .visitor-table td:nth-child(9) button {
                padding: 6px 8px !important;
                font-size: 10px !important;
                margin-right: 3px !important;
                display: block !important;
                width: 100% !important;
                margin-bottom: 4px !important;
            }
            
            .recent-activity { padding: 15px 10px; }
            .activity-item { 
                flex-direction: column; 
                align-items: flex-start; 
                gap: 5px; 
                padding: 10px 0; 
            }
        }

        @media (max-width: 480px) {
            .stats { grid-template-columns: 1fr 1fr; }
            
            .visitor-table {
                font-size: 11px;
            }
            
            /* On very small screens, hide arrival/departure columns but keep contact */
            .visitor-table th:nth-child(6),
            .visitor-table td:nth-child(6),
            .visitor-table th:nth-child(7),
            .visitor-table td:nth-child(7) {
                display: none;
            }
            
            .status-badge {
                font-size: 9px;
                padding: 3px 6px;
            }
        }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <div class="header">
            <img src="images/alex-davis-logo.png" alt="Alex Davis Care Group Logo" width="200">
            <h1>Alex Davis Care Group</h1>
            <p>📊 HelloHub Admin Dashboard</p>
            <p style="font-size: 13px; margin-top: 5px;">Real-time visitor management and analytics</p>
            <div style="position: absolute; top: 10px; right: 15px; font-size: 10px; opacity: 0.7;">
                Configured for: Alex Davis Care Group
            </div>
        </div>

        <div class="controls">
            <button class="btn btn-primary" onclick="loadVisitorData()">🔄 Refresh Data</button>
            <button class="btn btn-success" onclick="showAddVisitorForm()">➕ Add Visitor</button>
            <button class="btn btn-warning" onclick="clearAllData()">🗑️ Clear All Data</button>
            
            <div class="filters">
                <input type="text" class="filter-input" id="searchFilter" placeholder="Search visitors..." onkeyup="filterData()">
                <select class="filter-input" id="locationFilter" onchange="filterData()">
                    <option value="">All Locations</option>
                    <option value="The Royal">The Royal</option>
                    <option value="The Crown">The Crown</option>
                    <option value="Seabreeze">Seabreeze</option>
                </select>
                <select class="filter-input" id="statusFilter" onchange="filterData()">
                    <option value="">All Status</option>
                    <option value="arrived">Arrived</option>
                    <option value="departed">Departed</option>
                </select>
            </div>
        </div>

        <!-- Add Visitor Modal -->
        <div id="addVisitorModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000;">
            <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 30px; border-radius: 15px; width: 90%; max-width: 500px;">
                <h3 style="margin-bottom: 20px; color: #333;">➕ Add Visitor Record</h3>
                
                <div style="margin-bottom: 15px;">
                    <label style="display: block; margin-bottom: 5px; font-weight: bold;">First Name:</label>
                    <input type="text" id="modalFirstName" style="width: 100%; padding: 10px; border: 2px solid #e0e0e0; border-radius: 8px;">
                </div>
                
                <div style="margin-bottom: 15px;">
                    <label style="display: block; margin-bottom: 5px; font-weight: bold;">Surname:</label>
                    <input type="text" id="modalSurname" style="width: 100%; padding: 10px; border: 2px solid #e0e0e0; border-radius: 8px;">
                </div>
                
                <div style="margin-bottom: 15px;">
                    <label style="display: block; margin-bottom: 5px; font-weight: bold;">Email:</label>
                    <input type="email" id="modalEmail" style="width: 100%; padding: 10px; border: 2px solid #e0e0e0; border-radius: 8px;">
                </div>
                
                <div style="margin-bottom: 15px;">
                    <label style="display: block; margin-bottom: 5px; font-weight: bold;">Mobile:</label>
                    <input type="tel" id="modalMobile" style="width: 100%; padding: 10px; border: 2px solid #e0e0e0; border-radius: 8px;">
                </div>
                
                <div style="margin-bottom: 15px;">
                    <label style="display: block; margin-bottom: 5px; font-weight: bold;">User Type:</label>
                    <select id="modalUserType" style="width: 100%; padding: 10px; border: 2px solid #e0e0e0; border-radius: 8px;">
                        <option value="visitor">Visitor</option>
                        <option value="client">Client</option>
                        <option value="staff">Staff</option>
                    </select>
                </div>
                
                <div style="margin-bottom: 15px;">
                    <label style="display: block; margin-bottom: 5px; font-weight: bold;">Location:</label>
                    <select id="modalLocation" style="width: 100%; padding: 10px; border: 2px solid #e0e0e0; border-radius: 8px;">
                        <option value="The Royal">The Royal</option>
                        <option value="The Crown">The Crown</option>
                        <option value="Seabreeze">Seabreeze</option>
                    </select>
                </div>
                
                <div style="margin-bottom: 15px;">
                    <label style="display: block; margin-bottom: 5px; font-weight: bold;">Status:</label>
                    <select id="modalStatus" style="width: 100%; padding: 10px; border: 2px solid #e0e0e0; border-radius: 8px;">
                        <option value="arrived">Arrived</option>
                        <option value="departed">Departed</option>
                    </select>
                </div>
                
                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button class="btn btn-success" onclick="addVisitorRecord()" style="flex: 1;">✅ Add Visitor</button>
                    <button class="btn" onclick="hideAddVisitorForm()" style="flex: 1; background: #6c757d; color: white;">❌ Cancel</button>
                </div>
            </div>
        </div>

        <div class="stats">
            <div class="stat-card">
                <div class="stat-number" id="totalVisitors">-</div>
                <div class="stat-label">Total Visitors</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="currentlyInside">-</div>
                <div class="stat-label">Currently Inside</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="todayArrivals">-</div>
                <div class="stat-label">Today's Arrivals</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="averageVisitTime">-</div>
                <div class="stat-label">Avg Visit Time</div>
            </div>
        </div>

        <div class="data-section">
            <div class="section-title">📋 Visitor Log</div>
            <div id="dataDisplay" class="loading">
                Click "Refresh Data" to load visitor information
            </div>
        </div>

        <div class="recent-activity">
            <div class="section-title">🕒 Recent Activity</div>
            <div id="recentActivity">
                <div class="activity-item">
                    <span>No recent activity</span>
                    <span class="activity-time">-</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        const ADMIN_CONFIG = {
            // This will connect to the same Google Apps Script
            googleSheetsUrl: 'https://script.google.com/macros/s/AKfycbww0RF7xY5HLjcQnCRxYbko6YP3gFCnKQrSCYCtqD0GuaqensclJ6JxqYCknpGXc7F6/exec',
            refreshInterval: 30000 // Auto-refresh every 30 seconds
        };

        let allVisitorData = JSON.parse(localStorage.getItem('hellohubVisitors') || '[]');
        let filteredData = [];

        function loadVisitorData() {
            // Show loading state
            document.getElementById('dataDisplay').innerHTML = '<div class="loading">🔄 Refreshing visitor data...</div>';
            
            // Update refresh button to show it's working
            const refreshBtn = document.querySelector('button[onclick="loadVisitorData()"]');
            const originalText = refreshBtn.innerHTML;
            refreshBtn.innerHTML = '⏳ Refreshing...';
            refreshBtn.disabled = true;
            
            // Simulate a brief loading time for better UX
            setTimeout(() => {
                // Load data from localStorage
                const rawData = localStorage.getItem('hellohubVisitors');
                allVisitorData = JSON.parse(rawData || '[]');
                
                console.log('📊 Loaded visitor data:', allVisitorData.length, 'records');
                
                // Convert string dates back to Date objects
                allVisitorData = allVisitorData.map(visitor => ({
                    ...visitor,
                    timestamp: new Date(visitor.timestamp)
                }));

                displayVisitorData();
                updateStats();
                updateRecentActivity();
                
                // Reset refresh button
                refreshBtn.innerHTML = originalText;
                refreshBtn.disabled = false;
                
                // Show success message
                if (allVisitorData.length > 0) {
                    showMessage(`✅ Refreshed! Found ${allVisitorData.length} visitor records.`, 'success');
                } else {
                    showMessage('ℹ️ No visitor data found. Use HelloHub to check in visitors or click "Add Visitor".', 'info');
                }
            }, 500);
        }

        function showMessage(text, type = 'info') {
            // Remove any existing messages
            const existingMsg = document.querySelector('.temp-message');
            if (existingMsg) existingMsg.remove();
            
            // Create message element
            const message = document.createElement('div');
            message.className = 'temp-message';
            message.style.cssText = `
                position: fixed; top: 20px; right: 20px; z-index: 1001;
                padding: 15px 20px; border-radius: 8px; font-weight: bold;
                box-shadow: 0 4px 12px rgba(0,0,0,0.2);
                transform: translateX(400px); transition: all 0.3s ease;
                ${type === 'success' ? 'background: #d4edda; color: #155724; border: 1px solid #c3e6cb;' : ''}
                ${type === 'info' ? 'background: #e3f2fd; color: #0277bd; border: 1px solid #b3e5fc;' : ''}
                ${type === 'error' ? 'background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb;' : ''}
            `;
            message.textContent = text;
            
            document.body.appendChild(message);
            
            // Animate in
            setTimeout(() => {
                message.style.transform = 'translateX(0)';
            }, 100);
            
            // Remove after 3 seconds
            setTimeout(() => {
                message.style.transform = 'translateX(400px)';
                setTimeout(() => {
                    if (message.parentNode) {
                        message.parentNode.removeChild(message);
                    }
                }, 300);
            }, 3000);
        }

        function saveVisitorData() {
            // Save to localStorage
            localStorage.setItem('hellohubVisitors', JSON.stringify(allVisitorData));
        }

        function showAddVisitorForm() {
            document.getElementById('addVisitorModal').style.display = 'block';
        }

        function hideAddVisitorForm() {
            document.getElementById('addVisitorModal').style.display = 'none';
            // Clear form
            document.getElementById('modalFirstName').value = '';
            document.getElementById('modalSurname').value = '';
            document.getElementById('modalEmail').value = '';
            document.getElementById('modalMobile').value = '';
            document.getElementById('modalUserType').value = 'visitor';
            document.getElementById('modalLocation').value = 'The Royal';
            document.getElementById('modalStatus').value = 'arrived';
        }

        function addVisitorRecord() {
            const firstName = document.getElementById('modalFirstName').value.trim();
            const surname = document.getElementById('modalSurname').value.trim();
            
            if (!firstName || !surname) {
                showMessage('❌ Please enter both first name and surname.', 'error');
                return;
            }

            const now = new Date();
            const newVisitor = {
                timestamp: now.toISOString(),
                firstName: firstName,
                surname: surname,
                email: document.getElementById('modalEmail').value.trim() || 'Not provided',
                mobile: document.getElementById('modalMobile').value.trim() || 'Not provided',
                userType: document.getElementById('modalUserType').value,
                location: document.getElementById('modalLocation').value,
                arrivalDate: now.toLocaleDateString(),
                arrivalTime: now.toLocaleTimeString(),
                departureDate: document.getElementById('modalStatus').value === 'departed' ? now.toLocaleDateString() : '',
                departureTime: document.getElementById('modalStatus').value === 'departed' ? now.toLocaleTimeString() : '',
                status: document.getElementById('modalStatus').value
            };

            allVisitorData.unshift(newVisitor); // Add to beginning of array
            saveVisitorData();
            hideAddVisitorForm();
            loadVisitorData();
            
            showMessage(`✅ ${firstName} ${surname} has been added to the visitor log!`, 'success');
        }

        function displayVisitorData() {
            filteredData = [...allVisitorData];
            
            if (filteredData.length === 0) {
                document.getElementById('dataDisplay').innerHTML = 
                    '<div class="loading">No visitor data found. Use HelloHub check-in system or click "➕ Add Visitor" to add records.</div>';
                return;
            }

            let tableHTML = `
                <table class="visitor-table">
                    <thead>
                        <tr>
                            <th>Time</th>
                            <th>Name</th>
                            <th>Type</th>
                            <th>Location</th>
                            <th>Contact</th>
                            <th>Arrival</th>
                            <th>Departure</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            filteredData.forEach((visitor, index) => {
                const statusClass = visitor.status === 'arrived' ? 'status-arrived' : 'status-departed';
                const toggleAction = visitor.status === 'arrived' ? 'Check Out' : 'Check In';
                const toggleStatus = visitor.status === 'arrived' ? 'departed' : 'arrived';
                
                tableHTML += `
                    <tr>
                        <td>${new Date(visitor.timestamp).toLocaleTimeString()}</td>
                        <td><strong>${visitor.firstName} ${visitor.surname}</strong></td>
                        <td>${visitor.userType.charAt(0).toUpperCase() + visitor.userType.slice(1)}</td>
                        <td>${visitor.location}</td>
                        <td>${visitor.email}<br><small>${visitor.mobile}</small></td>
                        <td>${visitor.arrivalTime}</td>
                        <td>${visitor.departureTime || '-'}</td>
                        <td><span class="status-badge ${statusClass}">${visitor.status.toUpperCase()}</span></td>
                        <td>
                            <button class="btn" style="padding: 5px 10px; font-size: 12px; background: #17a2b8; color: white; margin-right: 5px;" 
                                    onclick="toggleVisitorStatus(${allVisitorData.indexOf(visitor)})">${toggleAction}</button>
                            <button class="btn" style="padding: 5px 10px; font-size: 12px; background: #dc3545; color: white;" 
                                    onclick="deleteVisitor(${allVisitorData.indexOf(visitor)})">Delete</button>
                        </td>
                    </tr>
                `;
            });

            tableHTML += '</tbody></table>';
            document.getElementById('dataDisplay').innerHTML = tableHTML;
        }

        function toggleVisitorStatus(index) {
            if (index >= 0 && index < allVisitorData.length) {
                const visitor = allVisitorData[index];
                const now = new Date();
                
                if (visitor.status === 'arrived') {
                    // Check out
                    visitor.status = 'departed';
                    visitor.departureDate = now.toLocaleDateString();
                    visitor.departureTime = now.toLocaleTimeString();
                } else {
                    // Check in
                    visitor.status = 'arrived';
                    visitor.departureDate = '';
                    visitor.departureTime = '';
                }
                
                saveVisitorData();
                loadVisitorData();
                alert(`✅ ${visitor.firstName} ${visitor.surname} has been ${visitor.status === 'arrived' ? 'checked in' : 'checked out'}`);
            }
        }

        function deleteVisitor(index) {
            if (index >= 0 && index < allVisitorData.length) {
                const visitor = allVisitorData[index];
                if (confirm(`⚠️ Are you sure you want to delete ${visitor.firstName} ${visitor.surname}'s record?`)) {
                    allVisitorData.splice(index, 1);
                    saveVisitorData();
                    loadVisitorData();
                    alert(`🗑️ ${visitor.firstName} ${visitor.surname}'s record has been deleted.`);
                }
            }
        }

        function updateStats() {
            const total = allVisitorData.length;
            const currentlyInside = allVisitorData.filter(v => v.status === 'arrived').length;
            const today = new Date().toLocaleDateString();
            const todayArrivals = allVisitorData.filter(v => v.arrivalDate === today).length;

            document.getElementById('totalVisitors').textContent = total;
            document.getElementById('currentlyInside').textContent = currentlyInside;
            document.getElementById('todayArrivals').textContent = todayArrivals;
            document.getElementById('averageVisitTime').textContent = '2.5h';
        }

        function updateRecentActivity() {
            const recent = allVisitorData
                .sort((a, b) => b.timestamp - a.timestamp)
                .slice(0, 5);

            let activityHTML = '';
            recent.forEach(visitor => {
                const action = visitor.status === 'arrived' ? 'checked in' : 'checked out';
                activityHTML += `
                    <div class="activity-item">
                        <span><strong>${visitor.firstName} ${visitor.surname}</strong> ${action} at ${visitor.location}</span>
                        <span class="activity-time">${visitor.timestamp.toLocaleTimeString()}</span>
                    </div>
                `;
            });

            if (activityHTML === '') {
                activityHTML = '<div class="activity-item"><span>No recent activity</span><span class="activity-time">-</span></div>';
            }

            document.getElementById('recentActivity').innerHTML = activityHTML;
        }

        function filterData() {
            const searchTerm = document.getElementById('searchFilter').value.toLowerCase();
            const locationFilter = document.getElementById('locationFilter').value;
            const statusFilter = document.getElementById('statusFilter').value;

            filteredData = allVisitorData.filter(visitor => {
                const matchesSearch = searchTerm === '' || 
                    visitor.firstName.toLowerCase().includes(searchTerm) ||
                    visitor.surname.toLowerCase().includes(searchTerm) ||
                    visitor.email.toLowerCase().includes(searchTerm);

                const matchesLocation = locationFilter === '' || visitor.location === locationFilter;
                const matchesStatus = statusFilter === '' || visitor.status === statusFilter;

                return matchesSearch && matchesLocation && matchesStatus;
            });

            displayVisitorData();
        }

        function exportToCSV() {
            if (allVisitorData.length === 0) {
                alert('No data to export');
                return;
            }

            const headers = ['Timestamp', 'First Name', 'Surname', 'Email', 'Mobile', 'User Type', 'Location', 'Arrival Date', 'Arrival Time', 'Departure Date', 'Departure Time', 'Status'];
            
            let csvContent = headers.join(',') + '\n';
            
            allVisitorData.forEach(visitor => {
                const row = [
                    visitor.timestamp.toISOString(),
                    visitor.firstName,
                    visitor.surname,
                    visitor.email,
                    visitor.mobile,
                    visitor.userType,
                    visitor.location,
                    visitor.arrivalDate,
                    visitor.arrivalTime,
                    visitor.departureDate || '',
                    visitor.departureTime || '',
                    visitor.status
                ].map(field => `"${field}"`).join(',');
                
                csvContent += row + '\n';
            });

            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `hellohub-visitors-${new Date().toISOString().split('T')[0]}.csv`;
            a.click();
            window.URL.revokeObjectURL(url);
        }

        function clearAllData() {
            if (confirm('⚠️ Are you sure you want to clear ALL visitor data? This cannot be undone!')) {
                allVisitorData = [];
                saveVisitorData();
                loadVisitorData();
                alert('🗑️ All visitor data has been cleared.');
            }
        }

        // Auto-refresh data every 30 seconds using silent refresh
        setInterval(() => silentRefresh(), ADMIN_CONFIG.refreshInterval);

        // Load initial data
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🏢 Admin Dashboard initialized for:', ADMIN_CONFIG.companyName);
            console.log('📍 Locations:', ADMIN_CONFIG.locations);
            console.log('🔗 Google Sheets URL:', ADMIN_CONFIG.googleSheetsUrl);
            loadVisitorData();
        });
    </script>
</body>
</html>
